<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>hello-wasm example</title>
  </head>
  <body>
    <script type="module">
      import init, {split_secret, combine_secret, generate_secret,verify_secret} from "./pkg/vsss_wasm.js";
      
      function buf2hex(buffer) { // buffer is an ArrayBuffer
        return [...new Uint8Array(buffer)]
            .map(x => x.toString(16).padStart(2, '0'))
            .join('');
      }

      init().then(() => {
        // We need to create the secret that conforms to curv25519 for secret sharing.
        var secret = generate_secret();
        console.log("secret : ", buf2hex(secret));

        var out = split_secret(secret);
        
        // each share is 32 bytes with two additional bytes for encoding
        var share1 = out.slice(0  ,34);
        var share2 = out.slice(34 ,67);
        var share3 = out.slice(68 ,101);
        var share4 = out.slice(102 ,135);
        var share5 = out.slice(136,169);

        var verifier = out.slice(170); // to the end
        console.log("verifer length : ", verifier.length);

        var verify = verify_secret(share3, verifier);
        console.log("verify 3rd share : ", verify);

        var reconstructed_secret = combine_secret(share1.concat(share3).concat(share5));
        console.log("combined secret : ", buf2hex(reconstructed_secret));

      });
    </script>
  </body>
</html>
